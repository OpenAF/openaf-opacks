# Author: Nuno Aguiar

todo:
- Generate html

ojob:
  opacks      :
  - openaf: 20210404
  catch       : logErr(exception);
  logToConsole: false   # to change when finished

jobs:
# ----------
- name: Help
  help: 
    text   : Tries to open a browser with the context map/array HTML representation
    #expects: 
    #- name   : something
    #  desc   : To do stuff
    #  example: aValueExample

# -------------------
- name: Generate html
  exec: |
    ow.loadTemplate();
    var c = {};
    if (isDef(__pm)) {
      sprint( Object.keys(__pm) );
      if (isDef(__pm._map))  c = ow.template.html.parseMap(__pm._map, true);
      if (isDef(__pm._list)) c = ow.template.html.parseMap(__pm._list, true);
    }
    var html = "<html><style>" + c.css + "</style><body>" + c.out + "</body></html>"; 

    var tmpf = io.createTempFile("ojobio_", ".html");
    io.writeFileString(tmpf, html);

    var res = openInBrowser("file:///" + tmpf.replace(/\\/g, "/"));
    if (res) {
       sleep(2500, true);
    } else {
       print(html);
    }
